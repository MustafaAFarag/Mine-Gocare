<div class="search-overlay" (click)="closeSearchPanel()"></div>
<div class="search-container bg-white p-4 shadow-md">
  <div class="flex items-center justify-between gap-4">
    <h2 class="text-xl font-semibold">{{ "search.title" | translate }}</h2>
    <button
      (click)="closeSearchPanel()"
      class="text-gray-500 hover:text-gray-700"
    >
      <i class="ri-close-line text-2xl"></i>
    </button>
  </div>

  <div class="relative my-4 flex flex-col gap-4">
    <div class="relative">
      <input
        type="text"
        [(ngModel)]="searchTerm"
        (ngModelChange)="onSearch()"
        placeholder="{{ 'search.placeholder' | translate }}"
        class="w-full rounded-md border border-gray-300 bg-white p-3 focus:outline-none focus:ring-2 focus:ring-blue-500"
        autofocus
      />
      <i
        class="ri-search-line absolute text-gray-400"
        [class.right-3]="translateService.currentLang === 'en'"
        [class.left-3]="translateService.currentLang === 'ar'"
        [class.top-3]="true"
      ></i>
    </div>
  </div>

  <div class="search-results overflow-y-auto">
    @if (isLoading) {
      <div class="flex items-center justify-center py-8">
        <app-loading></app-loading>
      </div>
    } @else if (filteredProducts.length === 0) {
      <div class="py-8 text-center text-gray-500">
        {{ "search.noResults" | translate }}
      </div>
    } @else {
      <div class="grid grid-cols-1 gap-4">
        @for (product of filteredProducts; track product.productId) {
          <div
            class="flex items-center justify-between gap-4 rounded-md p-3 transition-colors hover:bg-gray-50"
          >
            <a
              [routerLink]="[
                '/product-details',
                product.productId,
                product.variantId,
              ]"
              (click)="closeSearchPanel()"
              class="flex items-center gap-4"
            >
              <img
                [src]="getFullImageUrl(product.mainImageUrl)"
                [alt]="product.name.en"
                class="h-16 w-16 rounded-md object-cover"
              />
              <div class="flex flex-col gap-1">
                <h3 class="font-medium">{{ product.name.en }}</h3>
                <p class="text-sm text-gray-500">{{ product.brand.en }}</p>
                <div class="flex items-center gap-2">
                  <p class="font-medium text-hover-color">
                    {{ product.priceAfterDiscount }}
                    {{ product.currency.name.en }}
                  </p>
                  @if (
                    product.priceAfterDiscount !== product.priceBeforeDiscount
                  ) {
                    <p class="text-sm text-gray-500 line-through">
                      {{ product.priceBeforeDiscount }}
                      {{ product.currency.name.en }}
                    </p>
                    <p class="text-sm font-medium text-hover-color">
                      {{ product.discountPercentage.toFixed(2) }}% off
                    </p>
                  }
                </div>
              </div>
            </a>
            <div class="flex gap-2">
              <button
                (click)="addToWishlist(product)"
                class="flex items-center justify-center rounded-md border border-gray-300 p-2 text-gray-600 hover:bg-gray-100"
                title="Add to Wishlist"
              >
                <i class="ri-heart-line"></i>
              </button>
              <button
                (click)="addToCart(product)"
                class="flex items-center justify-center rounded-md bg-hover-color p-2 text-white hover:bg-opacity-90"
                title="Add to Cart"
              >
                <i class="ri-shopping-cart-line"></i>
              </button>
            </div>
          </div>
        }
      </div>
    }
  </div>
</div>
