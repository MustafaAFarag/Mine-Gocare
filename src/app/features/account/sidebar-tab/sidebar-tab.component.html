<!-- Sidebar -->
<div class="w-full rounded-lg bg-white shadow-sm">
  <!-- User Profile -->
  <div class="border-b p-6">
    <div *ngIf="isLoading" class="flex items-center justify-center py-4">
      <div
        class="h-8 w-8 animate-spin rounded-full border-4 border-gray-200 border-t-hover-color"
      ></div>
    </div>
    <div *ngIf="!isLoading" class="flex items-center gap-2">
      <div class="relative">
        <ng-container *ngIf="getProfileImageUrl() as imgUrl">
          <img
            *ngIf="imgUrl"
            [src]="imgUrl"
            [alt]="getFullName()"
            [attr.data-img-key]="imgUrl"
            class="h-12 w-12 rounded-md object-cover xl:h-16 xl:w-16"
          />
        </ng-container>
        <label
          for="profile-image-upload"
          class="absolute bottom-0 right-0 flex h-6 w-6 cursor-pointer items-center justify-center rounded-full bg-hover-color text-white transition hover:bg-hover-color/80"
        >
          <i class="ri-camera-line text-sm"></i>
          <input
            type="file"
            id="profile-image-upload"
            accept="image/*"
            (change)="onFileSelected($event)"
            class="hidden"
            [disabled]="isUploadingImage"
          />
        </label>
        <div
          *ngIf="isUploadingImage"
          class="absolute inset-0 flex items-center justify-center rounded-md bg-black/50"
        >
          <div
            class="h-6 w-6 animate-spin rounded-full border-2 border-white border-t-transparent"
          ></div>
        </div>
      </div>
      <div class="min-w-0 flex-1">
        <h3 class="font-medium text-gray-800">{{ getFullName() }}</h3>
        <div *ngIf="hasEmailAddress(); else noEmail">
          <p class="truncate text-sm text-gray-500" [title]="user.emailAddress">
            {{ user.emailAddress }}
          </p>
        </div>
        <ng-template #noEmail>
          <div *ngIf="!showEmailInput">
            <button
              (click)="addEmail()"
              id="account-sidebar-add-email-button"
              class="mt-1 flex items-center gap-1 text-sm text-hover-color hover:text-hover-color/80"
            >
              <i class="ri-add-line"></i>
              {{ "account.sidebar.addEmail" | translate }}
            </button>
          </div>
          <div *ngIf="showEmailInput" class="mt-2">
            <div class="flex flex-col gap-2">
              <input
                type="email"
                [(ngModel)]="emailInput"
                [placeholder]="'account.sidebar.emailPlaceholder' | translate"
                id="account-sidebar-email-input"
                class="w-full rounded border border-gray-300 bg-white px-3 py-2 text-sm focus:border-hover-color focus:outline-none"
              />
              <div class="flex gap-2">
                <button
                  (click)="updateEmail()"
                  id="account-sidebar-update-email-button"
                  [disabled]="isUpdatingEmail || !emailInput"
                  class="flex-1 rounded bg-hover-color py-1 text-sm text-white transition hover:bg-hover-color/80 disabled:opacity-50"
                >
                  <span *ngIf="!isUpdatingEmail">{{
                    "common.save" | translate
                  }}</span>
                  <span *ngIf="isUpdatingEmail">{{
                    "common.saving" | translate
                  }}</span>
                </button>
                <button
                  (click)="cancelEmailUpdate()"
                  id="account-sidebar-cancel-email-update-button"
                  [disabled]="isUpdatingEmail"
                  class="flex-1 rounded border border-gray-300 py-1 text-sm text-gray-700 transition hover:bg-gray-100 disabled:opacity-50"
                >
                  {{ "common.cancel" | translate }}
                </button>
              </div>
            </div>
          </div>
        </ng-template>
      </div>
    </div>
  </div>

  <!-- Navigation Menu -->
  <div class="py-2">
    <ul>
      <li *ngFor="let item of sidebarItems">
        <a
          [routerLink]="item.route"
          [id]="'account-sidebar-item-' + item.nameKey"
          [class.bg-[#CBB1DD]]="item.active"
          [class.text-purple-900]="item.active"
          class="flex items-center gap-2 px-6 py-3 font-medium hover:bg-hover-color/80"
        >
          <i [class]="item.icon" class="text-lg"></i>
          <span>{{ item.nameKey | translate }}</span>
        </a>
      </li>
    </ul>
  </div>

  <!-- Logout Button -->
  <div class="p-4">
    <button
      class="flex w-full items-center justify-center rounded bg-hover-color py-3 text-white transition hover:bg-hover-color/80"
      (click)="showLogoutConfirm()"
      id="account-sidebar-logout-button"
    >
      <i class="ri-logout-box-line mr-2"></i>
      {{ "account.sidebar.logout" | translate }}
    </button>
  </div>
</div>

<app-logout-confirm-modal
  [(visible)]="logoutConfirmVisible"
  (confirmLogout)="onLogoutConfirm()"
></app-logout-confirm-modal>
