<div class="rounded-lg bg-white p-6 shadow-sm">
  <!-- Address Book Header -->
  <div class="flex items-center justify-between gap-6 p-6">
    <h2 class="text-xl font-bold text-gray-800">
      {{ "address.title" | translate }}
    </h2>
    <button
      *ngIf="!showAddressForm"
      (click)="addNewAddress()"
      class="flex items-center gap-2 rounded bg-hover-color px-4 py-2 text-white transition hover:bg-red-700"
    >
      <i class="ri-add-line"></i> {{ "address.addNew" | translate }}
    </button>
  </div>

  <!-- Address Form -->
  <div *ngIf="showAddressForm" class="rounded-lg border p-5">
    <div class="flex items-center justify-between gap-4">
      <h3 class="text-lg font-semibold">
        {{
          editingAddressId
            ? ("address.updateAddress" | translate)
            : ("address.addNew" | translate)
        }}
      </h3>
      <button (click)="cancelForm()" class="text-gray-500 hover:text-gray-700">
        <i class="ri-close-line text-xl"></i>
      </button>
    </div>

    <form [formGroup]="addressForm" (ngSubmit)="submitForm()">
      <div class="grid grid-cols-1 gap-4 md:grid-cols-2">
        <!-- Full Name -->
        <div class="form-group">
          <label class="mb-1 block text-sm font-medium text-gray-700">{{
            "address.fullName" | translate
          }}</label>
          <input
            type="text"
            formControlName="fullName"
            class="w-full rounded-md border border-gray-300 bg-white px-3 py-2 focus:border-hover-color focus:outline-none"
            [ngClass]="{
              'border-red-500':
                addressForm.get('fullName')?.invalid &&
                addressForm.get('fullName')?.touched,
            }"
          />
          <div
            *ngIf="
              addressForm.get('fullName')?.invalid &&
              addressForm.get('fullName')?.touched
            "
            class="mt-1 text-xs text-red-500"
          >
            {{ "address.validation.fullNameRequired" | translate }}
          </div>
        </div>

        <!-- Phone Number -->
        <div class="form-group">
          <label class="mb-1 block text-sm font-medium text-gray-700">{{
            "address.phoneNumber" | translate
          }}</label>
          <input
            type="text"
            formControlName="phoneNumber"
            class="w-full rounded-md border border-gray-300 bg-white px-3 py-2 focus:border-hover-color focus:outline-none"
            [ngClass]="{
              'border-red-500':
                addressForm.get('phoneNumber')?.invalid &&
                addressForm.get('phoneNumber')?.touched,
            }"
          />
          <div
            *ngIf="
              addressForm.get('phoneNumber')?.invalid &&
              addressForm.get('phoneNumber')?.touched
            "
            class="mt-1 text-xs text-red-500"
          >
            {{ "address.validation.phoneNumberRequired" | translate }}
          </div>
        </div>

        <!-- Country -->
        <div class="form-group">
          <label class="mb-1 block text-sm font-medium text-gray-700">{{
            "address.country" | translate
          }}</label>
          <select
            formControlName="countryId"
            class="w-full rounded-md border border-gray-300 bg-white px-3 py-2 focus:border-hover-color focus:outline-none"
            [ngClass]="{
              'border-red-500':
                addressForm.get('countryId')?.invalid &&
                addressForm.get('countryId')?.touched,
            }"
          >
            <option [ngValue]="null" disabled>
              {{ "address.selectCountry" | translate }}
            </option>
            <option>1</option>
          </select>
          <div
            *ngIf="
              addressForm.get('countryId')?.invalid &&
              addressForm.get('countryId')?.touched
            "
            class="mt-1 text-xs text-red-500"
          >
            {{ "address.validation.countryRequired" | translate }}
          </div>
        </div>

        <!-- City -->
        <div class="form-group">
          <label class="mb-1 block text-sm font-medium text-gray-700">{{
            "address.city" | translate
          }}</label>
          <select
            formControlName="cityId"
            class="w-full rounded-md border border-gray-300 bg-white px-3 py-2 focus:border-hover-color focus:outline-none"
            [ngClass]="{
              'border-red-500':
                addressForm.get('cityId')?.invalid &&
                addressForm.get('cityId')?.touched,
            }"
          >
            <option [ngValue]="null" disabled>
              {{ "address.selectCity" | translate }}
            </option>
            <option>1</option>
          </select>
          <div
            *ngIf="
              addressForm.get('cityId')?.invalid &&
              addressForm.get('cityId')?.touched
            "
            class="mt-1 text-xs text-red-500"
          >
            {{ "address.validation.cityRequired" | translate }}
          </div>
        </div>

        <!-- District -->
        <div class="form-group">
          <label class="mb-1 block text-sm font-medium text-gray-700">{{
            "address.district" | translate
          }}</label>
          <select
            formControlName="districtId"
            class="w-full rounded-md border border-gray-300 bg-white px-3 py-2 focus:border-hover-color focus:outline-none"
            [ngClass]="{
              'border-red-500':
                addressForm.get('districtId')?.invalid &&
                addressForm.get('districtId')?.touched,
            }"
          >
            <option [ngValue]="null" disabled>
              {{ "address.selectDistrict" | translate }}
            </option>
            <option>1</option>
          </select>
          <div
            *ngIf="
              addressForm.get('districtId')?.invalid &&
              addressForm.get('districtId')?.touched
            "
            class="mt-1 text-xs text-red-500"
          >
            {{ "address.validation.districtRequired" | translate }}
          </div>
        </div>

        <!-- Type -->
        <div class="form-group">
          <label class="mb-1 block text-sm font-medium text-gray-700">{{
            "address.type" | translate
          }}</label>
          <select
            formControlName="type"
            class="w-full rounded-md border border-gray-300 bg-white px-3 py-2 focus:border-hover-color focus:outline-none"
          >
            <option [value]="0">{{ "address.types.home" | translate }}</option>
            <option [value]="1">{{ "address.types.work" | translate }}</option>
            <option [value]="2">
              {{ "address.types.office" | translate }}
            </option>
            <option [value]="3">{{ "address.types.other" | translate }}</option>
          </select>
        </div>

        <!-- Address -->
        <div class="form-group md:col-span-2">
          <label class="mb-1 block text-sm font-medium text-gray-700">{{
            "address.addressLine" | translate
          }}</label>
          <textarea
            formControlName="address"
            rows="3"
            class="w-full rounded-md border border-gray-300 bg-white px-3 py-2 focus:border-hover-color focus:outline-none"
            [ngClass]="{
              'border-red-500':
                addressForm.get('address')?.invalid &&
                addressForm.get('address')?.touched,
            }"
          ></textarea>
          <div
            *ngIf="
              addressForm.get('address')?.invalid &&
              addressForm.get('address')?.touched
            "
            class="mt-1 text-xs text-red-500"
          >
            {{ "address.validation.addressRequired" | translate }}
          </div>
        </div>

        <!-- Map Address -->
        <div class="form-group md:col-span-2">
          <label class="mb-1 block text-sm font-medium text-gray-700">{{
            "address.mapAddress" | translate
          }}</label>
          <input
            type="text"
            formControlName="mapAddress"
            class="w-full rounded-md border border-gray-300 bg-white px-3 py-2 focus:border-hover-color focus:outline-none"
          />
        </div>

        <!-- Default Address Checkbox -->
        <div class="form-group md:col-span-2">
          <div class="flex items-center gap-2">
            <input
              type="checkbox"
              id="isDefault"
              formControlName="isDefault"
              class="h-4 w-4 text-hover-color focus:ring-hover-color"
            />
            <label for="isDefault" class="text-sm text-gray-700">
              {{ "address.setAsDefault" | translate }}
            </label>
          </div>
        </div>
      </div>

      <!-- Submit Button -->
      <div class="mt-6 flex justify-end gap-3">
        <button
          type="button"
          (click)="cancelForm()"
          class="rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50"
        >
          {{ "common.cancel" | translate }}
        </button>
        <button
          type="submit"
          [disabled]="submitting"
          class="rounded-md bg-hover-color px-4 py-2 text-sm font-medium text-white hover:bg-red-700 disabled:opacity-70"
        >
          <span *ngIf="submitting">{{ "common.saving" | translate }}</span>
          <span *ngIf="!submitting">{{
            editingAddressId
              ? ("common.update" | translate)
              : ("common.save" | translate)
          }}</span>
        </button>
      </div>
    </form>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="py-8 text-center text-gray-500">
    <p>{{ "common.loading" | translate }}</p>
  </div>

  <!-- Address Cards -->
  <div
    *ngIf="!loading && !showAddressForm"
    class="grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-3"
  >
    <div
      *ngFor="let address of addresses"
      class="flex h-full flex-col overflow-hidden rounded-lg border"
    >
      <!-- Address Type Label -->
      <div class="flex items-center justify-between border-b p-4">
        <h3 class="font-medium text-gray-800">{{ address.fullName }}</h3>
        <span
          class="rounded-md px-3 py-1 text-sm font-medium"
          [ngClass]="getTypeClass(address.type)"
        >
          {{ getTypeLabel(address.type) }}
        </span>
      </div>

      <!-- Address Details -->
      <div class="flex-grow p-4">
        <div class="flex flex-col gap-2">
          <p class="text-gray-700">
            {{ address.address }}<br />
            {{ getLocalizedName(address.city) }},
            {{ getLocalizedName(address.district) }}<br />
            {{ getLocalizedName(address.country) }}
          </p>
          <p class="flex items-center gap-2 text-gray-700">
            <span class="text-gray-500"
              >{{ "address.phoneNumber" | translate }}:</span
            >
            {{ address.phoneNumber }}
          </p>
          <p
            *ngIf="address.isDefault"
            class="flex items-center gap-1 text-sm text-green-600"
          >
            <i class="ri-check-line"></i>
            {{ "address.defaultAddress" | translate }}
          </p>
        </div>
      </div>

      <!-- Address Actions -->
      <div class="mt-auto flex border-t">
        <button
          (click)="editAddress(address.id)"
          class="flex-1 border-r py-3 text-gray-700 transition hover:bg-gray-50"
          [disabled]="deletingAddressId === address.id"
        >
          {{ "common.edit" | translate }}
        </button>
        <button
          (click)="removeAddress(address.id)"
          class="flex-1 py-3 text-gray-700 transition hover:bg-gray-50"
          [disabled]="deletingAddressId === address.id"
        >
          <span *ngIf="deletingAddressId !== address.id">{{
            "common.remove" | translate
          }}</span>
          <span
            *ngIf="deletingAddressId === address.id"
            class="flex items-center justify-center gap-2"
          >
            <svg
              class="h-4 w-4 animate-spin"
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
            >
              <circle
                class="opacity-25"
                cx="12"
                cy="12"
                r="10"
                stroke="currentColor"
                stroke-width="4"
              ></circle>
              <path
                class="opacity-75"
                fill="currentColor"
                d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
              ></path>
            </svg>
            {{ "common.removing" | translate }}
          </span>
        </button>
      </div>
    </div>

    <!-- Empty State (shown when no addresses) -->
    <div
      *ngIf="!loading && addresses.length === 0 && !showAddressForm"
      class="col-span-full py-8 text-center text-gray-500"
    >
      <div class="flex flex-col items-center gap-4">
        <i class="ri-map-pin-line text-4xl text-gray-400"></i>
        <p>{{ "address.noAddresses" | translate }}</p>
        <button
          (click)="addNewAddress()"
          class="rounded bg-hover-color px-4 py-2 text-white transition hover:bg-red-700"
        >
          {{ "address.addFirstAddress" | translate }}
        </button>
      </div>
    </div>
  </div>
</div>
