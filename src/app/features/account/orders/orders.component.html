<div *ngIf="isLoading" class="flex justify-center py-8">
  <app-loading></app-loading>
</div>

<div
  *ngIf="!showOrderDetails && !isLoading"
  class="rounded-lg bg-white p-4 shadow-sm md:p-6"
>
  <h2 class="mb-4 text-xl font-bold text-gray-800 md:mb-6">
    {{ "account.orders.title" | translate }}
  </h2>

  <!-- Desktop Orders Table (hidden on mobile) -->
  <div class="hidden overflow-x-auto md:block">
    <table class="w-full">
      <!-- Table Header -->
      <thead>
        <tr class="border-b">
          <th class="px-4 py-4 text-left font-medium text-gray-700">
            {{ "account.orders.orderNumber" | translate }}
          </th>
          <th class="px-4 py-4 text-left font-medium text-gray-700">
            {{ "account.orders.date" | translate }}
          </th>
          <th class="px-4 py-4 text-left font-medium text-gray-700">
            {{ "account.orders.amount" | translate }}
          </th>
          <th class="px-4 py-4 text-center font-medium text-gray-700">
            {{ "account.orders.status" | translate }}
          </th>
          <th class="px-4 py-4 text-left font-medium text-gray-700">
            {{ "account.orders.paymentMethod" | translate }}
          </th>
          <th class="px-4 py-4 text-left font-medium text-gray-700">
            {{ "account.orders.option" | translate }}
          </th>
        </tr>
      </thead>

      <!-- Table Body -->
      <tbody>
        <tr
          *ngFor="let order of currentPageItems"
          class="border-b hover:bg-gray-50"
        >
          <td class="px-4 py-4 font-medium text-gray-700">
            {{ order.orderNumber }}
          </td>
          <td class="px-4 py-4 text-gray-700">
            {{ order.creationDate | date: "medium" : "UTC" }}
          </td>
          <td class="px-4 py-4 text-gray-700">
            {{ order.totalPayment }} {{ order.currency.name[currentLang] }}
          </td>
          <td class="px-4 py-4 text-center">
            <span
              class="rounded-md px-3 py-1 text-sm font-medium"
              [ngClass]="{
                'bg-yellow-100 text-yellow-600': order.status === 1,
                'bg-orange-100 text-orange-600': order.status === 2,
                'bg-blue-100 text-blue-600': order.status === 3,
                'bg-purple-100 text-purple-600': order.status === 4,
                'bg-indigo-100 text-indigo-600': order.status === 5,
                'bg-green-100 text-green-600': order.status === 6,
                'bg-red-100 text-red-600':
                  order.status === 7 || order.isCanceled,
              }"
            >
              {{
                order.isCanceled
                  ? ("account.orders.statusCanceled" | translate)
                  : order.status === 1
                    ? ("account.orders.statusNew" | translate)
                    : order.status === 2
                      ? ("account.orders.statusPending" | translate)
                      : order.status === 3
                        ? ("account.orders.statusConfirmed" | translate)
                        : order.status === 4
                          ? ("account.orders.statusPendingShipping" | translate)
                          : order.status === 5
                            ? ("account.orders.statusDeliveryInProgress"
                              | translate)
                            : order.status === 6
                              ? ("account.orders.statusDelivered" | translate)
                              : ("account.orders.statusUnknown" | translate)
              }}
            </span>
          </td>
          <td class="py-4 text-center text-gray-700">
            {{
              order.paymentMethod === 1
                ? ("account.orders.paymentCashOnDelivery" | translate)
                : order.paymentMethod === 2
                  ? ("account.orders.paymentCreditCard" | translate)
                  : order.paymentMethod === 3
                    ? ("account.orders.paymentWallet" | translate)
                    : order.paymentMethod === 4
                      ? ("account.orders.paymentRedeemingPoints" | translate)
                      : ("account.orders.paymentUnknown" | translate)
            }}
          </td>

          <td class="px-4 py-4 text-center">
            <div class="flex justify-center gap-3">
              <button
                (click)="viewOrderDetails(order.id)"
                id="orders-view-order-details-button"
                class="text-gray-500 hover:text-gray-700"
                [attr.aria-label]="'account.orders.viewDetails' | translate"
              >
                <i class="ri-eye-line"></i>
              </button>
            </div>
          </td>
        </tr>

        <!-- Empty State (shown when no orders) -->
        <tr *ngIf="orders.length === 0">
          <td colspan="6" class="py-8 text-center text-gray-500">
            <div class="flex flex-col items-center gap-2">
              <i class="ri-shopping-bag-line text-4xl text-gray-400"></i>
              <p>{{ "account.orders.noOrders" | translate }}</p>
              <a href="#" class="text-hover-color hover:text-red-800">{{
                "account.orders.startShopping" | translate
              }}</a>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Mobile Orders Cards (shown only on mobile) -->
  <div class="space-y-4 md:hidden">
    <div
      *ngFor="let order of currentPageItems"
      class="rounded-lg border p-4 shadow-sm"
    >
      <div class="mb-3 flex items-start justify-between">
        <div>
          <p class="font-medium text-gray-700">{{ order.orderNumber }}</p>
          <p class="text-sm text-gray-500">
            {{ order.creationDate | date: "dd MMM yyyy hh:mm a" }}
          </p>
        </div>
        <span
          class="rounded-md px-3 py-1 text-sm font-medium"
          [ngClass]="{
            'bg-yellow-100 text-yellow-600': order.status === 1,
            'bg-orange-100 text-orange-600': order.status === 2,
            'bg-blue-100 text-blue-600': order.status === 3,
            'bg-purple-100 text-purple-600': order.status === 4,
            'bg-indigo-100 text-indigo-600': order.status === 5,
            'bg-green-100 text-green-600': order.status === 6,
            'bg-red-100 text-red-600': order.status === 7 || order.isCanceled,
          }"
        >
          {{
            order.isCanceled
              ? ("account.orders.statusCanceled" | translate)
              : order.status === 1
                ? ("account.orders.statusNew" | translate)
                : order.status === 2
                  ? ("account.orders.statusPending" | translate)
                  : order.status === 3
                    ? ("account.orders.statusConfirmed" | translate)
                    : order.status === 4
                      ? ("account.orders.statusPendingShipping" | translate)
                      : order.status === 5
                        ? ("account.orders.statusDeliveryInProgress"
                          | translate)
                        : order.status === 6
                          ? ("account.orders.statusDelivered" | translate)
                          : ("account.orders.statusUnknown" | translate)
          }}
        </span>
      </div>

      <div class="mb-3 flex items-center justify-between">
        <div>
          <p class="text-sm text-gray-600">
            {{ "account.orders.amount" | translate }}:
          </p>
          <p class="font-medium">
            {{ order.totalPayment }} {{ order.currency.name[currentLang] }}
          </p>
        </div>
        <div>
          <p class="text-sm text-gray-600">
            {{ "account.orders.paymentMethod" | translate }}:
          </p>
          <p class="font-medium">
            {{
              order.paymentMethod === 1
                ? ("account.orders.paymentCashOnDelivery" | translate)
                : order.paymentMethod === 2
                  ? ("account.orders.paymentCreditCard" | translate)
                  : order.paymentMethod === 3
                    ? ("account.orders.paymentWallet" | translate)
                    : order.paymentMethod === 4
                      ? ("account.orders.paymentRedeemingPoints" | translate)
                      : ("account.orders.paymentUnknown" | translate)
            }}
          </p>
        </div>
      </div>

      <div class="mt-3 flex justify-end gap-3 border-t pt-3">
        <button
          (click)="viewOrderDetails(order.id)"
          id="orders-view-order-details-button"
          class="text-gray-500 hover:text-gray-700"
          [attr.aria-label]="'account.orders.viewDetails' | translate"
        >
          <i class="ri-eye-line"></i>
        </button>
      </div>
    </div>

    <!-- Empty State for Mobile (shown when no orders) -->
    <div *ngIf="orders.length === 0" class="py-8 text-center text-gray-500">
      <div class="flex flex-col items-center gap-2">
        <i class="ri-shopping-bag-line text-4xl text-gray-400"></i>
        <p>{{ "account.orders.noOrders" | translate }}</p>
        <a href="#" class="text-hover-color hover:text-red-800">{{
          "account.orders.startShopping" | translate
        }}</a>
      </div>
    </div>
  </div>

  <!-- Pagination Controls -->
  <div
    *ngIf="totalPages > 1"
    class="mt-6 flex items-center justify-center gap-2"
  >
    <button
      (click)="changePage(currentPage - 1)"
      id="orders-previous-page-button"
      [disabled]="currentPage === 1"
      class="rounded-md p-2 text-gray-600 hover:bg-gray-100 disabled:opacity-50"
      [attr.aria-label]="'account.orders.previousPage' | translate"
    >
      <i class="ri-arrow-left-s-line"></i>
    </button>

    <div class="flex gap-1">
      <button
        *ngFor="let page of [].constructor(totalPages); let i = index"
        (click)="changePage(i + 1)"
        id="orders-page-button"
        class="rounded-md px-3 py-1 text-sm font-medium"
        [ngClass]="{
          'bg-hover-color text-white': currentPage === i + 1,
          'text-gray-700 hover:bg-gray-100': currentPage !== i + 1,
        }"
      >
        {{ i + 1 }}
      </button>
    </div>

    <button
      (click)="changePage(currentPage + 1)"
      id="orders-next-page-button"
      [disabled]="currentPage === totalPages"
      class="rounded-md p-2 text-gray-600 hover:bg-gray-100 disabled:opacity-50"
      [attr.aria-label]="'account.orders.nextPage' | translate"
    >
      <i class="ri-arrow-right-s-line"></i>
    </button>
  </div>
</div>

<app-order-details
  *ngIf="showOrderDetails"
  [orderId]="selectedOrderId"
  [orderDetails]="orderDetails"
  (backClicked)="hideOrderDetails()"
></app-order-details>
