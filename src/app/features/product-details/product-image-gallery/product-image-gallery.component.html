<!-- Show loading indicator while images are being prepared -->
<div *ngIf="loadingImages" class="flex h-64 items-center justify-center">
  <div
    class="h-12 w-12 animate-spin rounded-full border-b-2 border-gray-900"
  ></div>
</div>

<!-- Show gallery when images are loaded -->
<div
  *ngIf="!loadingImages && images.length > 0"
  id="product-gallery"
  [class.sticky-active]="isSticky"
>
  <p-galleria
    [value]="images"
    [showItemNavigators]="true"
    [showThumbnailNavigators]="false"
    [responsiveOptions]="responsiveOptions"
    [circular]="true"
    [numVisible]="5"
    [containerStyle]="{ 'max-width': '640px' }"
  >
    <ng-template pTemplate="item" let-item>
      <img [src]="item.itemImageSrc" class="block w-full" [alt]="item.alt" />
    </ng-template>

    <ng-template pTemplate="thumbnail" let-item>
      <div class="thumbnail-wrapper">
        <img
          [src]="item.thumbnailImageSrc"
          class="block h-auto w-full rounded-lg border-2 border-transparent transition-all hover:border-red-500"
          [alt]="item.alt"
        />
      </div>
    </ng-template>
  </p-galleria>
</div>

<!-- Fallback in case no images are available -->
<div
  *ngIf="!loadingImages && !imagesLoaded && images.length === 0"
  class="relative flex h-64 items-center justify-center rounded-lg bg-gray-100"
>
  <img
    src="assets/default-image.png"
    alt="Default Product Image"
    class="h-full w-full rounded object-cover"
  />
</div>

<style>
  /* Navigation buttons styling */
  :host ::ng-deep .p-galleria-prev-button,
  :host ::ng-deep .p-galleria-next-button {
    background-color: gray;
  }

  :host ::ng-deep .p-galleria-prev-button:hover,
  :host ::ng-deep .p-galleria-next-button:hover {
    background-color: darkgray !important;
  }

  /* Thumbnails container styling - controls the overall thumbnails area */
  :host ::ng-deep .p-galleria-thumbnails {
    background: white !important;
    padding: 0.5rem 0; /* Controls vertical spacing of thumbnail strip */
    gap: 0.5rem; /* Controls spacing between thumbnails */
    display: flex;
    justify-content: center;
  }

  /* Thumbnail container background */
  :host ::ng-deep .p-galleria-thumbnail-container {
    background: white !important;
    padding: 0.25rem; /* Controls padding around all thumbnails */
  }

  :host ::ng-deep .p-galleria-thumbnails-content {
    background: white !important;
    padding: 0.25rem;
  }

  /* Individual thumbnail item styling */
  :host ::ng-deep .p-galleria-thumbnail-item {
    background: rgb(229 231 235) !important; /* gray-200 */
    border-radius: 0.5rem;
    margin: 0 0.25rem; /* Controls horizontal spacing between thumbnails */
    opacity: 0.7;
    transition: all 0.3s ease;
  }

  /* Selected thumbnail state */
  :host ::ng-deep .p-galleria-thumbnail-item.p-galleria-thumbnail-item-current {
    opacity: 1;
  }

  /* Hover state for thumbnails */
  :host ::ng-deep .p-galleria-thumbnail-item:hover {
    opacity: 1;
  }

  /* Individual thumbnail wrapper - controls padding inside each thumbnail box */
  :host ::ng-deep .thumbnail-wrapper {
    padding: 0.25rem;
  }

  /* Add max-width control to the main image container */
  :host ::ng-deep .p-galleria-item {
    max-width: 440px;
    margin: 0 auto;
  }

  @media (min-width: 1024px) {
    .sticky-active {
      position: sticky;
      top: 8rem; /* Increased from 1rem to 2rem to give more space at the top */
      z-index: 10;
      transition: all 0.3s ease-in-out;
    }
  }

  :host ::ng-deep .sticky .p-galleria {
    position: sticky;
    top: 8rem; /* Match the top spacing */
    z-index: 100;
    background-color: white;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease-in-out;
  }
</style>
