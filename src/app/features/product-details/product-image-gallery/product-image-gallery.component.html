<!-- Show loading indicator while images are being prepared -->
<div *ngIf="loadingImages" class="flex items-center justify-center h-64">
  <div
    class="animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900"
  ></div>
</div>

<!-- Show gallery when images are loaded -->
<div
  *ngIf="!loadingImages && images.length > 0"
  [ngClass]="{ sticky: isSticky }"
  id="product-gallery"
>
  <p-galleria
    [value]="images"
    [showItemNavigators]="true"
    [showThumbnailNavigators]="false"
    [responsiveOptions]="responsiveOptions"
    [circular]="true"
    [numVisible]="5"
    [containerStyle]="{ 'max-width': '640px' }"
  >
    <ng-template pTemplate="item" let-item>
      <img
        [src]="item.itemImageSrc"
        style="width: 100%; display: block"
        [alt]="item.alt"
      />
    </ng-template>

    <ng-template pTemplate="thumbnail" let-item>
      <img
        [src]="item.thumbnailImageSrc"
        style="width: 100%; display: block"
        [alt]="item.alt"
      />
    </ng-template>
  </p-galleria>
</div>

<!-- Fallback in case no images are available -->
<div
  *ngIf="!loadingImages && !imagesLoaded && images.length === 0"
  class="relative bg-gray-100 flex items-center justify-center rounded-lg h-64"
>
  <img
    src="assets/default-image.png"
    alt="Default Product Image"
    class="object-cover h-full w-full rounded"
  />
</div>

<style>
  :host ::ng-deep .p-galleria-prev-button,
  :host ::ng-deep .p-galleria-next-button {
    background-color: gray;
  }

  :host ::ng-deep .p-galleria-prev-button:hover,
  :host ::ng-deep .p-galleria-next-button:hover {
    background-color: darkgray !important;
  }

  :host ::ng-deep .p-galleria-thumbnails-content {
    background: darkgray;
  }

  .sticky {
    position: sticky;
    top: 0;
    z-index: 100;
    background-color: white;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    transition: top 0.3s ease-in-out, z-index 0s 0.3s; /* Smooth transition */
  }

  :host ::ng-deep .sticky .p-galleria {
    position: sticky;
    top: 0;
    z-index: 100;
    background-color: white;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  }
</style>
